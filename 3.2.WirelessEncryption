---

DAY 4: WIRELESS PENTESTING (WiFi Encryption PART2) 23/1/2023
;WPA (Wi-Fi Protected Access)
WPA (Wi-Fi Protected Access) is a security protocol that was developed to address the vulnerabilities of the WEP (Wired Equivalent Privacy) protocol. WPA was created as a short-term solution to provide stronger security than WEP
WPA uses the Advanced Encryption Standard (AES) algorithm for encryption, which is considered to be much more secure than the RC4 algorithm used by WEP. Additionally, WPA includes a mechanism for authentication called the Temporal Key Integrity Protocol (TKIP). TKIP provides per-packet key mixing, a message integrity check (MIC) named Michael, and a re-keying mechanism.
[+] WPA CIPHERS
I. TKIP (Temporal Key Integrity Protocol) (mode)
In TKIP the key mixing refers to the process of creating a new key for packet of data that is transmitted. This is done to increase the security of the encryption by ensuring that each packet is encrypted with a unique key.
In TKIP (Temporal Key Integrity Protocol), re-keying refers to the process of changing the key used for encryption and decryption. The key is changed periodically to prevent an attacker from breaking the encryption.
The re-keying process in TKIP can be triggered by either of the following:
A set number of packets have been transmitted.
A set period of time has passed.

The frequency of re-keying can be set by the network administrator and it can vary from one implementation to another. For example, a re-keying mechanism can be set to provide key generation every 10,000 packets. This means that after every 10,000 packets have been transmitted, the key will be changed and a new one will be generated.
The key for each packet is derived from the original shared key(i.e the wifi password)and a value that is unique to that packet called the packet number.
The process of creating the TKIP (Temporal Key Integrity Protocol) key for encrypting and decrypting data can be summarized as follows:
The shared key is entered into the wireless access point and the client devices that connect to the network.
The TKIP protocol generates a unique packet number for each packet of data that is transmitted.
The shared key and the packet number are used as inputs to the TKIP key mixing process. This process creates a new key for each packet.
The new key is used to encrypt the packet data.
The encrypted packet, along with the packet number and the MIC (Message Integrity Check), is then transmitted over the network.
When the packet is received, the TKIP protocol uses the packet number and the shared key to regenerate the key that was used to encrypt the packet.
The regenerated key is used to decrypt the packet data.
The MIC is used to ensure that the packet has not been tampered with, and that it came from the sender it claims to come from.

[ MIC (Message Integrity Check)
It is a 64-bit message integrity code that is calculated on the data payload of each packet and is included in the packet header.
When a packet is received, the MIC is recalculated and compared to the one included in the header. If the two MICs match, it means that the packet has not been tampered with, and it is accepted. If the two MICs do not match, it means that the packet has been tampered with, and it is rejected.
The process of creating the MIC for a packet can be summarized as follows:
The packet data is divided into blocks of data.
A keyed hash function called Michael takes the packet data and the shared key as inputs, and produces a 64-bit MIC as output.
The MIC is then included in the packet header and sent along with the packet.
When the packet is received, the MIC is recalculated using the same key and the packet data.
The newly calculated MIC is then compared with the one included in the packet header.
If the two MICs match, it means that the packet has not been tampered with, and it is accepted. If the two MICs do not match, it means that the packet has been tampered with, and it is rejected.) ]

II. TKIP + AES (Advanced Encryption Standard) mode
When using TKIP+AES, WPA uses TKIP for data encryption and AES for data integrity. This provides stronger security than TKIP alone, but it also requires more processing power.
encryption, the following steps occur:
The client device connects to the wireless network and initiates a 4-way handshake with the access point (AP) to establish a secure connection.
During the handshake, the client and AP exchange a set of keys and authentication information. The client generates a new temporal key (TK) for each session and sends it to the AP.
The AP then encrypts the data using TKIP, which provides per-packet key mixing, a message integrity check (MIC), and a re-keying mechanism.
Additionally, the AP also encrypts the data using AES, which provides stronger encryption than TKIP and is considered more secure.
The encrypted data is then sent over the wireless network.
The client device receives the data and decrypts it using the TK and AES keys that were exchanged during the handshake.
The client device then verifies the integrity of the data using the MIC to ensure that it has not been tampered with during transmission.
This process is repeated for each packet of data that is sent over the wireless network, ensuring that all data is encrypted and protected from unauthorized access.

---

[+]WPA Authentication
The authentication process for WPA involves the following steps:
The client device, such as a laptop or smartphone, attempts to connect to the WPA-protected network.
The access point (AP) sends a challenge text (a random string of characters) to the client device.
The client device uses the pre-shared key (PSK (i.e password)) to encrypt the challenge text and sends the encrypted text back to the AP.
The AP uses the PSK to decrypt the challenge text and compares it to the original challenge text it sent.
If the decrypted text matches the original challenge text, the AP sends an acknowledgement message to the client device, indicating that it has been successfully authenticated.
Once the client device is authenticated, it and the AP establish a secure session using TKIP or AES (or both) for encryption. TKIP uses a per-packet key, which is generated by the AP and sent to the client device, while AES uses a fixed key for the entire session.
Data is then exchanged between the client device and the AP, encrypted using the established key.

---

WPA2 (Wi-Fi Protected Access 2)
WPA2 is the successor to WPA and uses the Advanced Encryption Standard (AES) algorithm in addition to TKIP. It is considered to be more secure than WPA and is the current standard for wireless network security.
Both WPA and WPA2 use a combination of a passphrase and a network name (SSID) to provide a secure connection, but WPA2 is considered to be more secure because it uses stronger encryption (AES) and a more secure authentication method EAP.
However, there are some key differences between the way WPA2 is typically implemented in home networks versus enterprise networks.
In a home network, WPA2 is usually implemented using a pre-shared key (PSK) for authentication. This means that the wireless network's name (SSID) and password are set up by the user, and all devices connecting to the network must use the same SSID and password. This method is relatively simple to set up and manage, but it is less secure than other methods because the password can be easily compromised if it is not complex and unique.
On the other hand, in an enterprise network, WPA2 is typically implemented using a more secure authentication method such as EAP (Extensible Authentication Protocol) and a RADIUS (Remote Authentication Dial-In User Service) server. EAP methods such as EAP-TLS, EAP-PEAP, or EAP-TTLS use digital certificates and user's credentials for authentication. This method is more secure than using a PSK because it provides both server and client authentication, and it allows for the use of more complex and unique credentials. Additionally, an enterprise network would use a RADIUS server to manage user access and to handle the EAP authentication process.
[+] EAP for authentication
EAP, or Extensible Authentication Protocol, is a framework for authentication that is used in conjunction with various other authentication methods, such as Wi-Fi Protected Access 2 (WPA2). EAP allows for the use of multiple authentication methods within a single framework, making it more flexible than methods that only support a single authentication method.
Here is an overview of the EAP authentication process in WPA2:
The client sends an EAP-Start message to the authentication server, indicating that it wants to start an EAP authentication process.
The authentication server sends an EAP-Request/Identity message to the client, asking the client to provide its identity.
The client sends an EAP-Response/Identity message to the authentication server, containing the client's identity (such as a username).
The authentication server sends an EAP-Request message to the client, asking the client to authenticate using a specific EAP method (such as EAP-TLS, EAP-PEAP, or EAP-TTLS).
The client sends an EAP-Response message to the authentication server, containing the client's authentication information (such as a digital certificate or a password).
The authentication server verifies the client's authentication information and sends an EAP-Success or EAP-Failure message to the client.
If the authentication is successful, the client and the authentication server establish a secure key (such as a Temporal Key Integrity Protocol (TKIP) or Advanced Encryption Standard (AES) key) that is used to encrypt data transmitted over the wireless network.
The client can now access the network resources.

Note that the exact steps and messages exchanged may vary depending on the specific EAP method used.
TYPES OF EAPs
Here's a brief summary of the key differences between the three methods:
EAP-TLS: This method uses X.509 digital certificates for authentication. It provides both server and client authentication, making it one of the most secure EAP methods. EAP-TLS is commonly used in enterprise networks that require a high level of security.
EAP-PEAP: This method uses a combination of digital certificates and a user's credentials (such as a username and password) for authentication. EAP-PEAP creates a secure tunnel between the client and the authentication server, protecting the user's credentials from being transmitted in plaintext.
EAP-TTLS: This method uses a combination of digital certificates and a user's credentials for authentication. EAP-TTLS creates a secure tunnel between the client and the authentication server, and it can be used with a variety of different inner authentication methods such as PAP, CHAP, MS-CHAP, and MS-CHAPv2.

EAP-TLS is considered more secure than other EAP methods because it requires the use of X.509 digital certificates for both server and client authentication. EAP-PEAP and EAP-TTLS provide a good balance of security and ease of use and are more suitable for situations where not all clients have digital certificates

---
